<div class="post-form-container">
  <!-- Header -->
  <div class="post-header">
    <div class="title">
      <mat-icon class="header-icon">{{ mode() === 'edit' ? 'edit_note' : 'create' }}</mat-icon>
      <h1>{{ getTitle() }}</h1>
    </div>
    <button mat-icon-button class="close-btn" (click)="onCancel()" matTooltip="Cancel">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  @if (formError()) {
  <app-error-banner [message]="formError()" />
  }

  <!-- Form -->
  <form class="post-form" [formGroup]="postForm" (submit)="onSubmit()">
    <!-- Title Field -->
    <mat-form-field class="title-field">
      <mat-label>Post Title</mat-label>
      <input
        matInput
        type="text"
        placeholder="Enter a title for your article"
        formControlName="title"
        maxlength="100"
      />
      <mat-icon matPrefix>title</mat-icon>
      <mat-hint align="end">{{ postForm.get('title')?.value?.length || 0 }}/100</mat-hint>
      <mat-error>{{ getErrorMessage('title') }}</mat-error>
    </mat-form-field>

    <!-- Content Editor -->
    <div class="editor-section">
      <textarea id="content-editor" formControlName="content"></textarea>
      @if (postForm.get('content')?.invalid && postForm.get('content')?.touched) {
      <div class="editor-error">
        <mat-icon class="error-icon">error</mat-icon>
        <span>{{ getErrorMessage('content') }}</span>
      </div>
      }
    </div>

    <!-- Upload Loading Indicator -->
    @if (isUploadingMedia()) {
    <div class="upload-loading">
      <mat-spinner diameter="24"></mat-spinner>
      <span>Uploading media...</span>
    </div>
    }

    <!-- Action Buttons -->
    <div class="form-actions">
      <button
        mat-stroked-button
        type="button"
        (click)="onCancel()"
        [disabled]="isSubmitting()"
        class="cancel-btn"
      >
        <mat-icon>close</mat-icon>
        Cancel
      </button>

      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="postForm.invalid || isSubmitting() || isUploadingMedia()"
        class="submit-btn"
      >
        @if (isSubmitting()) {
        <div class="button-content">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
          <span>{{ getSubmitButtonText() }}</span>
        </div>
        } @else {
        <div class="button-content">
          <mat-icon>{{ mode() === 'edit' ? 'check' : 'send' }}</mat-icon>
          <span>{{ getSubmitButtonText() }}</span>
        </div>
        }
      </button>
    </div>
  </form>
</div>
